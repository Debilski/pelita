<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><title>Pelita</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <script src="processing-1.3.6.min.js"></script> 

    
    <!-- Le styles -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding: 2em 3em;
      }
    </style>
    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
  </head>
  <body>
    <div id="main">

      <script type="text/javascript">
        var agents = Array();
      </script>


      <h1><span id="team_0"><span class="name">Team</span> <span class="score"></span></span> :
        <span id="team_1"><span class="score"></span> <span class="name">Team</span></span></h1>

      <p><span id="ws_status"class="label"></span></p>

      <p><i class="icon-info-sign"></i>Round: <span id="round_index"></span>; Last bot: <span id="bot_id"></span></p>

      <canvas id="canvas1" data-processing-sources="pelita.pde"></canvas>


      <script type="text/javascript">
        function getParameterByName(name) {
          // http://stackoverflow.com/questions/901115
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            var regexS = "[\\?&]" + name + "=([^&#]*)";
            var regex = new RegExp(regexS);
            var results = regex.exec(window.location.search);
            if(results == null)
              return "";
            else
              return decodeURIComponent(results[1].replace(/\+/g, " "));
          }

          var ws_host = getParameterByName("host");
          var ws_uri = "ws://" + (ws_host || "localhost") + ":51011/";

          var ws = new WebSocket(ws_uri);
          ws.onmessage = function(event) { 
            data = JSON.parse(event.data);
            wall = data.walls;
            food = data.food;
            state = data.state;
            teams = data.teams;

            init_game();

            $("#team_0 .name").text(teams[0].name);
            $("#team_0 .score").text(teams[0].score);
            $("#team_1 .name").text(teams[1].name);
            $("#team_1 .score").text(teams[1].score);

            $("#round_index").text(state.round_index);
            $("#bot_id").text(state.bot_id);

            for (idx = 0; idx < data.bots.length; idx++) {
              agents[idx].setNext(data.bots[idx].x, data.bots[idx].y);
            }
          };

        var ws_status = $("#ws_status");
        ws.onerror = function(event) {
          ws_status.addClass("label-warning");
          ws_status.removeClass("label-success");
          ws_status.text("Websocket error");
        };

        ws.onopen = function(event) {
          ws_status.addClass("label-success");
          ws_status.removeClass("label-warning");
          ws_status.text("Connected to " + ws_uri);
        };

        ws.onclose = function(event) {
          ws_status.removeClass("label-success");
          ws_status.removeClass("label-warning");
          ws_status.text("Connection closed");
        };

        function up(num) {
        if (agents[num]) agents[num].up();
        }
        function down(num) {
        if (agents[num]) agents[num].down();
        }
        function left(num) {
        if (agents[num]) agents[num].left();
        }
        function right(num) {
        if (agents[num]) agents[num].right();
        }
      </script>

      <form name="Formular" action="">
        <input type="button" value=" ∧ " onclick="up(2)" />
        <input type="button" value=" ∨ " onclick="down(2)" />
        <input type="button" value=" &lt; " onclick="left(2)" />
        <input type="button" value=" &gt; " onclick="right(2)" />
      </form>


    </div>
  </body>
</html>

